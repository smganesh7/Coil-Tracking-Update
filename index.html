<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coil Tracking Update</title>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 8px;
        }
        th, td {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Coil Tracking Update</h1>
    
    <form id="inventoryForm">
        <label for="product">Coil Number:</label>
        <input type="text" id="product" name="product" required><br><br>

        <label for="bay">Bay:</label>
        <select id="bay" name="bay">
            <option value="MN">MN</option>
            <option value="NP">NP</option>
            <option value="PQ">PQ</option>
            <option value="RS">RS</option>
            <option value="ST">ST</option>
        </select><br><br>
        
        <label for="column">Column:</label>
        <input type="text" id="column" name="column" maxlength="1" placeholder="A-Z" required><br><br>
        
        <label for="row">Row:</label>
        <input type="number" id="row" name="row" min="1" max="26" required><br><br>
        
        <button type="button" onclick="updateInventory()">Update Inventory</button>
    </form>
    
    <h2>Inventory Status</h2>
    <button type="button" onclick="deleteSelectedEntries()">Delete Selected Entries</button>
    <button type="button" onclick="downloadAsExcel()">Download as Excel</button>
    <button type="button" onclick="downloadAsPDF()">Download as PDF</button>
    <input type="checkbox" id="selectAll" onclick="toggleSelectAll()"> Select/Deselect All
    <div id="inventoryTable">
        <table>
            <tr>
                <th>Coil Number</th>
                <th>Bay</th>
                <th>Column</th>
                <th>Row</th>
                <th>Select</th>
            </tr>
            <!-- Static data -->
            <tr>
                <td>1234</td>
                <td>MN</td>
                <td>A</td>
                <td>1</td>
                <td><input type="checkbox" class="delete-checkbox"></td>
            </tr>
            <tr>
                <td>5678</td>
                <td>NP</td>
                <td>B</td>
                <td>2</td>
                <td><input type="checkbox" class="delete-checkbox"></td>
            </tr>
            <!-- Add more rows as needed -->
        </table>
    </div>
    
    <script>
        // Function to update inventory
        function updateInventory() {
            const bay = document.getElementById('bay').value;
            const column = document.getElementById('column').value.toUpperCase();
            const row = document.getElementById('row').value;
            const product = document.getElementById('product').value;

            let table = document.getElementById('inventoryTable').querySelector('table');
            
            // Check if entry already exists
            let exists = false;
            let rows = table.querySelectorAll('tr');
            for (let i = 1; i < rows.length; i++) {
                let cells = rows[i].querySelectorAll('td');
                if (cells[1].textContent === bay && cells[2].textContent === column && cells[3].textContent === row) {
                    if (!confirm(`Do you want to replace coil number ${cells[0].textContent} with ${product} at ${bay}-${column}-${row}?`)) {
                        return;
                    }
                    cells[0].textContent = product;
                    exists = true;
                    break;
                }
            }

            // If entry doesn't exist, add a new row
            if (!exists) {
                let newRow = document.createElement('tr');
                newRow.innerHTML = `<td>${product}</td><td>${bay}</td><td>${column}</td><td>${row}</td><td><input type="checkbox" class="delete-checkbox"></td>`;
                table.appendChild(newRow);
            }
        }

        // Function to delete selected entries
        function deleteSelectedEntries() {
            const checkboxes = document.querySelectorAll('.delete-checkbox:checked');
            if (checkboxes.length === 0) {
                alert('No entries selected for deletion.');
                return;
            }
            if (!confirm('Are you sure you want to delete the selected entries?')) {
                return;
            }
            checkboxes.forEach(checkbox => {
                checkbox.parentNode.parentNode.remove();
            });
        }

        // Function to download inventory as Excel
        function downloadAsExcel() {
            let wb = XLSX.utils.book_new();
            let ws_data = [['Coil Tracking Update'], [''], ['Coil Number', 'Bay', 'Column', 'Row']];

            let rows = document.querySelectorAll('#inventoryTable table tr');
            rows.forEach(row => {
                let cells = row.querySelectorAll('td');
                if (cells.length === 5) { // Ensure it's a data row
                    ws_data.push([cells[0].textContent, cells[1].textContent, cells[2].textContent, cells[3].textContent]);
                }
            });

            let ws = XLSX.utils.aoa_to_sheet(ws_data);
            XLSX.utils.book_append_sheet(wb, ws, "Inventory");
            XLSX.writeFile(wb, "Inventory.xlsx");
        }

        // Function to download inventory as PDF
        function downloadAsPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ format: 'a4' });

            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text("Coil Tracking Update", doc.internal.pageSize.getWidth() / 2, 20, { align: 'center' });
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');

            let columns = ["Coil Number", "Bay", "Column", "Row"];
            let tableData = [];

            let rows = document.querySelectorAll('#inventoryTable table tr');
            rows.forEach(row => {
                let cells = row.querySelectorAll('td');
                if (cells.length === 5) { // Ensure it's a data row
                    tableData.push([cells[0].textContent, cells[1].textContent, cells[2].textContent, cells[3].textContent]);
                }
            });

            doc.autoTable({
                head: [columns],
                body: tableData,
                startY: 30,
                styles: { 
                    cellPadding: 3, 
                    fontSize: 10, 
                    halign: 'center', 
                    valign: 'middle', 
                    lineWidth: 0.5,
                    lineColor: [0, 0, 0] 
                },
                tableLineColor: [0, 0, 0],
                tableLineWidth: 0.5
            });

            doc.save("Inventory.pdf");
        }

        // Function to toggle select/deselect all
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.delete-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        }
    </script>
</body>
</html>
